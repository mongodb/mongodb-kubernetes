# nix-cache.env
#
# Central configuration for the MCK S3-based Nix binary cache.
# Sourced by all devbox cache scripts.
#
# The S3 bucket acts as a shared /nix/store for the team.
# Cache resolution order:
#   1. Local /nix/store (instant)
#   2. S3 bucket (fast, same-region = free egress from EC2)
#   3. cache.nixos.org (public Nix cache, slowest)

# --- S3 Bucket Configuration ---

# S3 bucket name for the Nix binary cache
MCK_NIX_CACHE_BUCKET="${MCK_NIX_CACHE_BUCKET:-mck-nix-cache}"

# AWS region where the bucket lives. Use same region as Evergreen workers
# to avoid cross-region data transfer costs.
MCK_NIX_CACHE_REGION="${MCK_NIX_CACHE_REGION:-us-east-1}"

# Full S3 URI used by nix commands
MCK_NIX_CACHE_S3_URI="s3://${MCK_NIX_CACHE_BUCKET}?region=${MCK_NIX_CACHE_REGION}"

# --- Signing Key Configuration ---

# Public key for verifying cached packages.
# Generated by: ./scripts/devbox/generate-cache-keys.sh
# Override via MCK_NIX_CACHE_PUBLIC_KEY env var if rotating keys.
MCK_NIX_CACHE_PUBLIC_KEY="${MCK_NIX_CACHE_PUBLIC_KEY:-mck-nix-cache-1:SHJAfGZ0e2dMt7FUVCX3xXYIrON13hzsh7oiLo1VmJg=}"

# Key name (must match the name used during key generation)
MCK_NIX_CACHE_KEY_NAME="${MCK_NIX_CACHE_KEY_NAME:-mck-nix-cache-1}"

# --- Private Key ---
# The private signing key content, passed as an environment variable.
# On CI, set this via Evergreen's project secrets or expansion variables.
# Locally, export it before running push-cache.sh.
#
# Example:
#   export MCK_NIX_CACHE_PRIV_KEY="$(cat /path/to/nix-cache-priv-key.pem)"
#   ./scripts/devbox/push-cache.sh
MCK_NIX_CACHE_PRIV_KEY="${MCK_NIX_CACHE_PRIV_KEY:-}"

# --- Devbox Configuration ---

# Devbox version to install if not present
DEVBOX_VERSION="${DEVBOX_VERSION:-latest}"

# Nix installer URL (Determinate Systems installer, supports macOS + Linux)
NIX_INSTALLER_URL="${NIX_INSTALLER_URL:-https://install.determinate.systems/nix}"
